function mapView(e,t,i){function a(){if("Android"==Ti.App.Properties.getString("osname")){var t=Titanium.UI.createView({width:Ti.UI.FILL,height:90,top:0}),i=Titanium.UI.createImageView({image:"/images/button_search_near.png",top:10,width:300,height:54}),a=Titanium.UI.createLabel({text:"or, fill out the form below",color:"#666",width:300,textAlign:"center",font:{fontFamily:"Arial",fontSize:14},top:70});t.add(i),t.add(a),t.addEventListener("click",function(){if(0==Ti.Network.online){var e=Titanium.UI.createAlertDialog({message:"Please connect to the internet to locate yourself on the map",title:"No Internet Connection"});e.show()}else n()})}var o=[],s=require("/builders/databaseFunctions/createCountryCountyList"),l=s(e),d=require("/builders/databaseFunctions/createDoubleField"),u=d("Venue Town","Example Town");o.push(l[0]),o.push(l[1]),o.push(u[0]);var c=require("/builders/submitButtonStyle"),f=c();f.addEventListener("click",function(){var t=require("/builders/createApplicationWindow"),i=(t(e,null,"Venue Map","#d2e8f5",null,null,null,null),require("/builders/startActInd")),a=i(r);r.setTouchEnabled(!1);var n=u[1].getValue(),o="SELECT * FROM Venue JOIN VenueCoords ON Venue.VenueID=VenueCoords.VenueID WHERE VenueCoords.Latitude IS NOT NULL",s="",d="",c="",f=null,p=null;if("Choose a Country"!=l[0].title&&"United Kingdom"!=l[0].title)var s=' AND Country="'+l[0].title+'"',f=!0;if("United Kingdom"==l[0].title){var s=' AND (Country="United Kingdom" OR Country="England" OR Country="Scotland" OR Country="Wales" OR Country="Northern Ireland" OR Country="Channel Islands" OR Country="Isle of Man")',f=!1;p=!0}if("Choose a County"!=l[1].title)var d=' AND County="'+l[1].title+'"',f=!0;if(""!=n)var c=' AND Town LIKE "%'+n+'%"',f=!0;var m=o+s+d+c;if(1==f){{var g=require("/builders/createMapView"),h=g(e,m,"Venue Map",null,"Map","Form Search",null,null),t=require("/builders/createApplicationWindow"),v=(t(e,h,"Venue Map","#d2e8f5","Map","Form Search","",""),require("/builders/endActInd"));v(r,a[0],a[1])}r.setTouchEnabled(!0)}else{var T=Titanium.UI.createAlertDialog({title:"Error",message:"To search, please fill out one or more fields"});1==p&&T.setTitle("To search, please either choose a county or enter the name of a town"),T.show();{var v=require("/builders/endActInd");v(r,a[0],a[1])}r.setTouchEnabled(!0)}});var p=Titanium.UI.createTableView({data:o,backgroundColor:"#d2e8f5",footerView:f,top:"0%",scrollable:!1});"iPad"!=Ti.App.Properties.getString("osname")&&(p.setWidth(300),p.setTop(10)),"Android"!=Ti.App.Properties.getString("osname")?p.setStyle(Titanium.UI.iPhone.TableViewStyle.GROUPED):p.setHeaderView(t),"iPad"==Ti.App.Properties.getString("osname")&&(p.setWidth(600),p.setHeight("100%"),p.setScrollable(!1),p.setTop(100)),r.add(p)}function n(){var t=require("/builders/createApplicationWindow"),i=(t(e,null,"Venue Map","#d2e8f5",null,null,null,null),require("/builders/startActInd")),a=i(r);r.setTouchEnabled(!1);{var n=require("/builders/createMapView"),o=n(e,null,"Venue Map",!0,"Map","Geolocation",null,null),t=require("/builders/createApplicationWindow"),s=(t(e,o,"Venue Map","#d2e8f5","Map","Geolocation","",""),require("/builders/endActInd"));s(r,a[0],a[1])}r.setTouchEnabled(!0)}var r=Titanium.UI.createWindow({backgroundColor:i,title:t,width:Ti.UI.FILL,height:Ti.UI.FILL});"Android"!=Ti.App.Properties.getString("osname")&&(r.setBarColor("#2195be"),r.setBackButtonTitle("Back"),r.setTintColor("#FFF"),r.setTranslucent(!1),r.setTitleControl(Ti.UI.createLabel({text:t,color:"#FFF",width:Ti.UI.SIZE})));var o=Titanium.UI.createWebView({html:'<html><head><script type="text/javascript" src="s_code.js"></script></head><body><script>s.channel="'+Ti.App.Properties.getString("osname")+'";s.pageName="Map";var s_code=s.t(); if(s_code)document.write(s_code)</script> <script>if(navigator.appVersion.indexOf("MSIE")>=0)document.write(unescape("%3C")+"!-"+"-")</script><noscript><img src="https://cmpi.122.2o7.net/b/ss/cmpivenuefinderappprod/1/H.25.2--NS/0?[AQB]&cdp=3&[AQE]"height="1" width="1" border="0" alt="" /></noscript></body></html>',opacity:0,width:0,height:0,left:0,right:0,touchEnabled:!1});r.add(o),a();var o=Titanium.UI.createWebView({html:'<html><head><script type="text/javascript" src="s_code.js"></script></head><body><script>s.channel="'+Ti.App.Properties.getString("osname")+'";s.pageName="Map";s.events="event4";var s_code=s.t(); if(s_code)document.write(s_code)</script> <script>if(navigator.appVersion.indexOf("MSIE")>=0)document.write(unescape("%3C")+"!-"+"-")</script><noscript><img src="https://cmpi.122.2o7.net/b/ss/cmpivenuefinderappprod/1/H.25.2--NS/0?[AQB]&cdp=3&[AQE]"height="1" width="1" border="0" alt="" /></noscript></body></html>',opacity:"0",width:"0",height:"0",left:"0",right:"0",touchEnabled:!1});r.add(o);var s=Titanium.UI.createButton({title:"Near You"});"android"!=Ti.Platform.osname&&r.setRightNavButton(s),s.addEventListener("click",function(){if(0==Ti.Network.online){var e=Titanium.UI.createAlertDialog({message:"Please connect to the internet to locate yourself on the map",title:"No Internet Connection"});e.show()}else n()});var l=require("/builders/databaseFunctions/createDatabase"),d=(l("/venuefinder.db","venuefinder"),Titanium.UI.createAlertDialog({title:"Show Venues Near Me",message:"Would you like to see up to 500 venues within a 25 mile radius of your location",buttonNames:["No Thanks","Yes Please"],opened:!1}));if(1==Titanium.Network.online){e.addEventListener("focus",function(){"Map"==e.activeTab.title&&0==d.opened&&(d.show(),d.opened=!0)});var o=Titanium.UI.createWebView({html:'<html><head><script type="text/javascript" src="s_code.js"></script></head><body><script>s.channel="'+Ti.App.Properties.getString("osname")+'";s.pageName="Map";s.prop1="Near Me";var s_code=s.t(); if(s_code)document.write(s_code)</script> <script>if(navigator.appVersion.indexOf("MSIE")>=0)document.write(unescape("%3C")+"!-"+"-")</script><noscript><img src="https://cmpi.122.2o7.net/b/ss/cmpivenuefinderappprod/1/H.25.2--NS/0?[AQB]&cdp=3&[AQE]"height="1" width="1" border="0" alt="" /></noscript></body></html>',opacity:"0",width:"0pts",height:"0pts",left:"0pts",right:"0pts",touchEnabled:!1});r.add(o)}return d.addEventListener("click",function(e){1==e.index?(a(),n()):a()}),r}module.exports=mapView;