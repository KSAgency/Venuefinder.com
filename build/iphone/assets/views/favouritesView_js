function favouritesView(e,t,i){function a(){var e="Your Rating";"StarRating"==u&&(e="Your Rating"),"DateAdded"==u&&(e="Date Added"),"VenueName"==u&&(e="Venue Name");var t=Titanium.UI.createTableViewRow({hasChild:!0,height:50}),i=Ti.UI.createLabel({text:"Sorted By: "+e,color:"#2195be",font:{fontSize:"16",fontFamily:"Arial",fontWeight:"bold"},left:15});"Android"==Ti.App.Properties.getString("osname")&&i.setLeft(0),t.add(i),d.push(t),i.addEventListener("click",function(){var e=[];e[0]=Titanium.UI.createPickerRow({title:"Please select a sorting option",sortValue:"0"}),e[1]=Titanium.UI.createPickerRow({title:"Your Rating",sortValue:"StarRating",orderType:"DESC"}),e[2]=Titanium.UI.createPickerRow({title:"Date Added",sortValue:"DateAdded",orderType:"DESC"}),e[3]=Titanium.UI.createPickerRow({title:"Venue Name",sortValue:"VenueName",orderType:"ASC"});var t=Titanium.UI.createPicker({bottom:0,width:Ti.UI.FILL,selectionIndicator:!0,zIndex:10});if(t.add(e),s.add(t),t.addEventListener("change",function(){"Android"==Ti.App.Properties.getString("osname")?(u=t.getSelectedRow(0).sortValue,c=t.getSelectedRow(0).orderType,"0"!=u&&(d=[],a(),n(),h.setData(d),s.remove(t))):(u=t.getSelectedRow(0).sortValue,c=t.getSelectedRow(0).orderType)}),"Android"!=Ti.App.Properties.getString("osname")){var i=Titanium.UI.createButton({title:"Done",color:"#FFF"}),r=Titanium.UI.createButton({systemButton:Titanium.UI.iPhone.SystemButton.FLEXIBLE_SPACE}),o=Titanium.UI.iOS.createToolbar({items:[r,i],bottom:"215",borderTop:!0,borderBottom:!0,barColor:"#2195be"});s.add(o),i.addEventListener("click",function(){s.remove(t),s.remove(o),d=[],a(),n(),h.setData(d)})}})}function n(){if("android"!=Ti.Platform.osname){var t=Titanium.UI.createButton({title:"Share All"});t.addEventListener("click",function(){r()}),s.setRightNavButton(t)}for(var i=g.execute("SELECT * FROM Favourites ORDER BY "+u+" "+c);i.isValidRow();){var o=i.fieldByName("VenueID"),l=i.fieldByName("VenueName"),m=i.fieldByName("PackageCode"),v=i.fieldByName("StarRating"),T=i.fieldByName("AddressLine1"),b=i.fieldByName("AddressLine2"),I=i.fieldByName("Town"),w=i.fieldByName("County"),y=i.fieldByName("Country"),E=i.fieldByName("Postcode");if(""!=T&&null!=T)var T=T+", ";else var T="";if(""!=b&&null!=b)var b=b+", ";else var b="";if(""!=I&&null!=I)var I=I+", ";else var I="";if(""!=w&&null!=w)var w=w+", ";else var w="";if(""!=y&&null!=y)var y=y;else var y="";if(""!=E&&null!=E)var E=E+", ";else var E="";var S=Titanium.UI.createTableViewRow({height:110,selectedBackgroundColor:"#FFF",uniqueID:o,venueName:l,venuePackage:m,bubbleParent:!1}),A=Titanium.UI.createImageView({image:"/images/rateButton.png",right:10,top:10,height:29,width:50,goDetail:!0});S.add(A);var L=Titanium.UI.createImageView({image:"/images/deleteButton.png",right:10,bottom:10,height:29,width:50,goDelete:!0});S.add(L);var x=Titanium.UI.createLabel({text:l,left:10,width:250,height:30,top:0,ellipsize:!0,color:"#2195be",font:{fontSize:18,fontWeight:"Bold"},touchEnabled:!1,bubbleParent:!1}),C=x.text+"\n",V=Titanium.UI.createLabel({text:T+b+I+w+E+y,left:10,top:30,width:240,height:40,ellipsize:!0,color:"#A2BE1C",font:{fontSize:16},touchEnabled:!1,bubbleParent:!1});"Android"!=Ti.App.Properties.getString("osname")&&(x.setLeft(15),V.setLeft(15)),S.add(V);var U=V.text+"\n \n";if(p=+C+U,null!=v){var F=Titanium.UI.createButton({backgroundImage:"/images/"+v+"star.png",left:10,height:27,width:138,bottom:10,touchEnabled:!1,selectedColor:"transparent",touchEnabled:!1,bubbleParent:!1});"Android"!=Ti.App.Properties.getString("osname")&&F.setLeft(15),S.add(F)}else{var _=Titanium.UI.createLabel({text:"",left:8,width:120,height:75,bottom:10,ellipsize:!0,color:"#666",font:{fontSize:16},touchEnabled:!1,bubbleParent:!1});"Android"!=Ti.App.Properties.getString("osname")&&_.setLeft(15),S.add(_)}S.add(x),S.addEventListener("click",function(t){if(Ti.API.info(t.source),Ti.API.info(t.source.goDetail),Ti.API.info(t.source.goDelete),1==t.source.goDetail){f=t.rowData.uniqueID;var i=require("/builders/createApplicationWindow"),r=i(e,null,"Edit Favourite","#d2e8f5",null,null,null,null);e.activeTab.open(r);var o=[],s=Ti.UI.createTableViewRow({title:"Rate This Venue",hasChild:!0,backgroundColor:"#FFF",font:{fontFamily:"Arial",fontSize:14},height:50,color:"#399ad4"});o.push(s);var l=Titanium.UI.createTableView({style:Titanium.UI.iPhone.TableViewStyle.GROUPED,backgroundColor:"#d2e8f5",data:o,height:100,top:10,width:290});r.add(l),l.addEventListener("click",function(){var e=[];e[0]=Ti.UI.createPickerRow({title:"Please select a rating",value:"0"}),e[1]=Ti.UI.createPickerRow({title:"5 - Excellent",value:"5"}),e[2]=Ti.UI.createPickerRow({title:"4 - Very Good",value:"4"}),e[3]=Ti.UI.createPickerRow({title:"3 - Good",value:"3"}),e[4]=Ti.UI.createPickerRow({title:"2 - Average",value:"2"}),e[5]=Ti.UI.createPickerRow({title:"1 - Poor",value:"1"});var t=Ti.UI.createPicker({bottom:0,selectionIndicator:!0,zIndex:10});if(t.add(e),r.add(t),"Android"!=Ti.App.Properties.getString("osname")){var i=Titanium.UI.createButton({title:"Done",color:"#FFF"});r.setRightNavButton(i),i.addEventListener("click",function(){{var e=require("/builders/databaseFunctions/createDatabase"),i=e("/favourites.db","favourites"),o=t.getSelectedRow(0).value,l=t.getSelectedRow(0).title;i.execute('UPDATE Favourites SET StarRating="'+o+'" WHERE venueID="'+f+'"')}i.close(),"android"!=Ti.Platform.osname&&r.setRightNavButton(null),r.remove(t),s.setTitle(l),d=[],a(),n(),h.setData(d)})}else t.addEventListener("change",function(){var e=t.getSelectedRow(0).value,i=t.getSelectedRow(0).title;if("0"!=e){{var o=require("/builders/databaseFunctions/createDatabase"),l=o("/favourites.db","favourites");l.execute('UPDATE Favourites SET StarRating="'+e+'" WHERE venueID="'+f+'"')}l.close(),r.remove(t),s.setTitle(i),d=[],a(),n(),h.setData(d)}})})}else if(1==t.source.goDelete){var u=Titanium.UI.createAlertDialog({title:"Confirmation",message:"Please confirm that you would like to delete "+t.rowData.venueName+" from your favourites",buttonNames:["Cancel","Delete"]});u.show();var c=t.rowData.uniqueID;u.addEventListener("click",function(e){if(1==e.index){S.remove(A),S.remove(L);var t=require("/builders/databaseFunctions/createDatabase"),i=t("/favourites.db","favourites");i.execute('DELETE FROM Favourites WHERE VenueID="'+c+'"'),i.close(),d=[],n(),h.setData(d),d=[],a(),n(),h.setData(d)}})}else{var i=require("/builders/createApplicationWindow");i(e,"children/featuredListing",t.rowData.venueName,"#FFF","Favourites",t.rowData.venueName,null,null,t.rowData.uniqueID,null)}}),d.push(S),i.next()}var N=d.length-1;s.setTitle("Favourites ("+N+")")}function r(){for(var t=require("/builders/databaseFunctions/createDatabase"),i=t("/favourites.db","favourites"),a=i.execute("SELECT * FROM Favourites");a.isValidRow();){var n=a.fieldByName("VenueID"),r=a.fieldByName("VenueName"),o=a.fieldByName("AddressLine1"),s=(a.fieldByName("AddressLine2"),a.fieldByName("Town")),l=a.fieldByName("County"),d=a.fieldByName("Postcode"),u='<a href="http://www.venuefinder.com/venues/v'+n+'">'+r+"</a> </br>",c=o+", "+s+", "+l+", "+d+"</br></br>",f=u.toString()+c.toString(),p="";p+=f,a.next()}{var m=require("/builders/createEmailer"),g=m(e,null,p,"shareAll",null,"Favourites","Share All",null,null),h=require("/builders/createApplicationWindow");h(e,g,"Share All","#d2e8f5","Favourites","Share All",null,null,null,null)}}function o(){d=[],a(),n(),h.setData(d)}var s=Titanium.UI.createWindow({backgroundColor:i,title:t,width:Ti.UI.FILL,height:Ti.UI.FILL});s.addEventListener("click",function(e){alert(e.source)}),"Android"!=Ti.App.Properties.getString("osname")&&(s.setBarColor("#2195be"),s.setBackButtonTitle("Back"),s.setTintColor("#FFF"),s.setTranslucent(!1),s.setTitleControl(Ti.UI.createLabel({text:t,color:"#FFF",width:Ti.UI.SIZE})));var l=Titanium.UI.createWebView({html:'<html><head><script type="text/javascript" src="s_code.js"></script></head><body><script>s.channel="iPhone";s.pageName="Favourites";var s_code=s.t(); if(s_code)document.write(s_code)</script> <script>if(navigator.appVersion.indexOf("MSIE")>=0)document.write(unescape("%3C")+"!-"+"-")</script><noscript><img src="https://cmpi.122.2o7.net/b/ss/cmpivenuefinderappprod/1/H.25.2--NS/0?[AQB]&cdp=3&[AQE]"height="1" width="1" border="0" alt="" /></noscript></body></html>',opacity:"0",width:"0",height:"0",left:"0",right:"0",touchEnabled:!1});s.add(l);var d=[],u="StarRating",c="DESC",f="",p=[],m=require("/builders/databaseFunctions/createDatabase"),g=m("/favourites.db","favourites");a(),n();var h=Titanium.UI.createTableView({data:d,editing:!1,editable:!1,backgroundColor:"#FFF",top:0,bubbleParent:!1});return"iPad"==Ti.App.Properties.getString("osname")&&h.setWidth(600),s.add(h),[s,o]}module.exports=favouritesView;