function venueList(e,t,i){for(var a=e.styleID,n=getVenues("A",a,t),r=["#","A","B","C","D","E","F","G","H","I","J","K","L","M"],o=["N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],s=require("/builders/databaseFunctions/createDatabase"),l=s("/venuefinder.db","venuefinder"),d=Ti.UI.createView({width:"350",height:"22",top:"0",left:"71",zIndex:101,layout:"horizontal"}),u=0;u<r.length;u++){var c=Ti.UI.createButton({width:"20",height:"24",top:"0",left:"5",title:r[u],font:{fontSize:"23",fontFamily:Ti.App.Properties.getString("fontFamily")},color:"#2195be",clickID:u});d.add(c);var f="";("3"==a||"15"==a||"39"==a)&&(f='AND Venue.Town = "London"');var p;p="#"==r[u]?'SELECT * FROM Venue WHERE VenueSort < "A" and VenueID in (select venueid from venuetovenuestyles where venuestyleid = '+a+') AND PackageCode in ("GLD","SIL","PRE") '+f+" ORDER BY venuesort ASC":'SELECT Venue.VenueID FROM Venue JOIN VenueToVenueStyles ON Venue.VenueID = VenueToVenueStyles.VenueID WHERE VenueToVenueStyles.VenueStyleID="'+a+'" AND (PackageCode="GLD" OR PackageCode="SIL" OR PackageCode="PRE") AND VenueSort LIKE "'+r[u]+'%" '+f+" ORDER BY VenueSort ASC";var m=l.execute(p);m.rowCount<=0&&(c.setColor("#999999"),c.setTouchEnabled(!1))}var g=d.getChildren()[1];d.addEventListener("click",function(r){if(r.source.title){var o=require("/builders/startActInd"),s=o(e);if(g!=r.source&&(r.source.font={fontWeight:"bold",fontFamily:"Arial",fontSize:"24"},g&&(g.font={fontWeight:"normal",fontFamily:Ti.App.Properties.getString("fontFamily"),fontSize:"24"}),g=r.source),void 0!=n&&i.remove(n),n=getVenues(r.source.title,a,t),void 0==n){{var l=require("/builders/endActInd");l(e,s[0],s[1])}noResultWindow()}else{i.add(n);{var l=require("/builders/endActInd");l(e,s[0],s[1])}}}}),i.add(d);for(var h=Ti.UI.createView({width:"350",height:"22",top:"0",right:"81",zIndex:101,layout:"horizontal"}),u=0;u<o.length;u++){var c=Ti.UI.createButton({width:"20",height:"24",top:"0",left:"5",title:o[u],font:{fontSize:"23",fontFamily:Ti.App.Properties.getString("fontFamily")},color:"#2195be",clickID:u,backgroundColor:"transparent"});h.add(c);var f="";("3"==a||"15"==a||"39"==a)&&(f='AND Venue.Town = "London"');var p;p="#"==o[u]?'SELECT * FROM Venue WHERE VenueSort < "A" and VenueID in (select venueid from venuetovenuestyles where venuestyleid = '+a+') AND PackageCode in ("GLD","SIL","PRE") '+f+" ORDER BY venuesort ASC":'SELECT Venue.VenueID FROM Venue JOIN VenueToVenueStyles ON Venue.VenueID = VenueToVenueStyles.VenueID WHERE VenueToVenueStyles.VenueStyleID="'+a+'" AND (PackageCode="GLD" OR PackageCode="SIL" OR PackageCode="PRE") AND VenueSort LIKE "'+o[u]+'%" '+f+" ORDER BY VenueSort ASC";var m=l.execute(p);m.rowCount<=0&&(c.setColor("#999999"),c.setTouchEnabled(!1))}return h.addEventListener("click",function(r){if(r.source.title){var o=require("/builders/startActInd"),s=o(e);if(g!=r.source&&(r.source.font={fontWeight:"bold",fontFamily:"Arial",fontSize:"24"},g&&(g.font={fontWeight:"normal",fontFamily:Ti.App.Properties.getString("fontFamily"),fontSize:"24"}),g=r.source),void 0!=n&&i.remove(n),n=getVenues(r.source.title,a,t),void 0==n){{var l=require("/builders/endActInd");l(e,s[0],s[1])}noResultWindow()}else{i.add(n);{var l=require("/builders/endActInd");l(e,s[0],s[1])}}}}),d.getChildren()[1].font={fontWeight:"bold",fontFamily:"Arial",fontSize:"24"},i.add(h),void 0==n?noResultWindow():i.add(n),e.add(i),i}function getVenues(e,t,i){var a=require("/builders/databaseFunctions/createDatabase"),n=a("/venuefinder.db","venuefinder"),r=[],o="";("3"==t||"15"==t||"39"==t)&&(o='AND Venue.Town = "London"');var s;s="#"==e?'SELECT * FROM Venue WHERE VenueSort < "A" and VenueID in (select venueid from venuetovenuestyles where venuestyleid = '+t+') AND PackageCode in ("GLD","SIL","PRE") '+o+" ORDER BY venuesort ASC":'SELECT * FROM Venue JOIN VenueToVenueStyles ON Venue.VenueID = VenueToVenueStyles.VenueID WHERE VenueToVenueStyles.VenueStyleID="'+t+'" AND (PackageCode="GLD" OR PackageCode="SIL" OR PackageCode="PRE") AND VenueSort LIKE "'+e+'%" '+o+" ORDER BY VenueSort ASC";var l=n.execute(s);if(l.rowCount<=0)return void 0;for(;l.isValidRow();){if(void 0!=l.fieldByName("VenueName")){var d=[];d.venueID=l.fieldByName("VenueID"),d.venueName=l.fieldByName("VenueName"),d.venueTown=l.fieldByName("Town"),d.bedroomsNo=l.fieldByName("BedroomsNo"),d.postCode=l.fieldByName("Postcode"),d.meetingRoomsNo=l.fieldByName("MeetingRoomsNo"),d.packageCode=l.fieldByName("PackageCode");var u=n.execute('SELECT * FROM VenueAdvertOptionsForWeb WHERE VenueID="'+d.venueID+'" AND (OptionCode="TOP" OR OptionCode="PIC")'),c="";u.isValidRow()&&(c=u.fieldByName("GraphicFileName")),d.imageUrl=c;var f="";""!=d.venueTown?f=""!=d.postCode?d.venueTown+", "+d.postCode:d.venueTown:""!=d.postCode&&(f=d.postCode),d.location=f,r.push(d)}l.next()}n.close();var p=require("/views/collview/getVenueThumbView"),m=[],g=r.length;if(0!=g)for(var h=Math.ceil(g/4),v=0,b=0,T=11,w=84,I=0;h>I;I++){for(var y=Titanium.UI.createTableViewRow({height:191,selectionStyle:"none",backgroundColor:"rgba(255,255,255,0)",zIndex:101,top:"0"}),S=80,V=0;4>V;V++){var E=r[v];if(void 0!=E&&void 0!=E.venueName){2==V&&(S=S+w-T);var C=r,A=p.getVenueThumb(r[v],b,S,i,C,!1);y.add(A),S=S+168+T}v++}m.push(y)}var L=Ti.UI.createView({backgroundColor:"rgba(255,255,255,0)",top:"30",width:"938",height:"573",zIndex:101,visible:!0}),x=Ti.UI.createTableView({backgroundColor:"rgba(255,255,255,0)",data:m,width:Ti.UI.FILL,height:Ti.UI.FILL,separatorColor:"transparent"});return L.add(x),L}function noResultWindow(){var e=Titanium.UI.createLabel({text:"Your search returned no results, please try again with a different search term.",color:"#999",font:{fontFamily:"Arial",fontSize:18}}),t=Titanium.UI.createWindow({backgroundColor:"rgba(0,0,0,0.8)"}),i=Titanium.UI.createButton({right:"5%",top:"5%",height:"20",zIndex:1,title:"X",color:"#FFF",font:{fontSize:"28",fontWeight:"bold"}});t.add(i),i.addEventListener("click",function(){t.close()});var a=Ti.UI.createView({width:"80%",height:"80%",top:"10%",left:"10%",backgroundColor:"#d2e8f5"});a.add(e),t.add(a),t.open(),db.close()}module.exports=venueList;