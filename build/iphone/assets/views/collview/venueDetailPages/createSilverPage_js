function createDetailPage(e){var t=dbUtil.getVenueForId(e),i=createViewBackground(t);i.add(createGallery(t));var a=createTitleLocation(t);i.add(a[0]),i.add(a[1]);var n=logoAndDescText(t);i.add(n[0]),i.add(n[1]),i.add(side2Gallery(t)),i.add(createHeaderElements.createFeaturedButtons(t.VenueID,i)),i.add(createVenueDetail(t));var r=createSilverSpeOfferBtn(t);return null!=r&&i.add(r),i.add(seeMoreInfoButton()),i}function createViewBackground(e){var t=Ti.App.Properties.getString("styleName"),i=require("/views/collview/getVenueThumbView"),a=i.setWindowPageStyle(t,!0),n=a[0],r=e.Town;"London"==e.Town&&(r=r+"  "+e.Postcode);var o=Ti.UI.createLabel({color:"#000000",top:"6",right:"18",font:{fontSize:"14",fontFamily:Ti.App.Properties.getString("fontFamily")},text:r,width:"300",height:"35",textAlign:Titanium.UI.TEXT_ALIGNMENT_RIGHT});return n.add(o),n}function createGallery(e){for(var t=require("/builders/databaseFunctions/createDatabase"),i=t("/venuefinder.db","venuefinder"),a=i.execute("SELECT * FROM VenueAdvertOptionsForWeb WHERE VenueID="+e.VenueID+" AND (OptionCode = 'TOP' OR OptionCode = 'PIC') ORDER BY OptionCode, OrderKey, GraphicFileName DESC"),n=[],r=Ti.UI.createView({width:410,height:214,left:36,top:70}),o=0;a.isValidRow();){var l=(a.fieldByName("OptionCode"),a.fieldByName("GraphicFileName"));if(0==o){var s=Ti.UI.createScrollView({width:"265",height:"214",top:"0",left:"0",borderRadius:"0",contentWidth:Ti.UI.FILL,contentHeight:Ti.UI.FILL,scrollingEnabled:!1}),d=Titanium.UI.createImageView({image:"http://www.venuefinder.com/adverts/"+l,defaultImage:"/images/icon.png",index:o,width:Ti.UI.FILL,height:Ti.UI.FILL,left:0,top:0});s.add(d),r.add(s)}else{var u=10,c=15;1==o?(u=0,c=280):2==o&&(u=116,c=280);var s=Ti.UI.createScrollView({width:"130",height:"102",top:u,left:c,borderRadius:"0",contentWidth:Ti.UI.FILL,contentHeight:Ti.UI.FILL,scrollingEnabled:!1}),f=Titanium.UI.createImageView({image:"http://www.venuefinder.com/adverts/"+l,defaultImage:"/images/icon.png",index:o,width:Ti.UI.FILL,height:Ti.UI.FILL,left:0,top:0});s.add(f),r.add(s)}if(o++,n.push("http://www.venuefinder.com/adverts/"+l),a.next(),3==o)break}return i.close(),r}function createTitleLocation(e){var t=Titanium.UI.createLabel({text:e.VenueName,ellipsize:!0,color:"#000000",width:"350",height:"24",top:"326",left:"98",font:{fontSize:"28"}}),i=Titanium.UI.createLabel({text:e.Town+", "+e.Country,ellipsize:!0,color:"#000000",width:"350",height:"16",top:"362",left:"98",font:{fontSize:"24",fontFamily:Ti.App.Properties.getString("fontFamily")}});return[t,i]}function logoAndDescText(e){for(var t,i=createDatabase("/venuefinder.db","venuefinder"),a=i.execute('SELECT DescriptionText FROM VenueTextForWeb WHERE VenueID="'+e.VenueID+'"');a.isValidRow();)t=a.fieldByName("DescriptionText"),a.next();(null==t||""==t)&&(t="No description could be retrieved for this venue."),t.replace("/<(?:.|\n)*?>/gm","");for(var n,r=Titanium.UI.createWebView({html:'<span style="font-family:Arial; color:#000; font-size:14px; line-height:20pts; font-size:15px;">'+t+"</span>",width:"225",height:"235",bottom:"10",left:"240"}),o=i.execute("SELECT * FROM VenueAdvertOptionsForWeb WHERE VenueID="+e.VenueID+" AND (OptionCode = 'LG1' ) ORDER BY OptionCode DESC");o.isValidRow();)n=o.fieldByName("GraphicFileName"),o.next();var l=Ti.UI.createScrollView({width:"150",height:"80",bottom:"80",left:"50",borderRadius:"0",contentWidth:Ti.UI.FILL,contentHeight:Ti.UI.FILL,scrollingEnabled:!1}),s=Titanium.UI.createImageView({image:"http://www.venuefinder.com/adverts/"+n,defaultImage:"/images/icon.png",width:"auto",height:Ti.UI.FILL,left:0,top:0});return l.add(s),i.close(),[l,r]}function side2Gallery(e){for(var t=createDatabase("/venuefinder.db","venuefinder"),i=t.execute("SELECT * FROM VenueAdvertOptionsForWeb WHERE VenueID='"+e.VenueID+"' AND (OptionCode='MIL' OR OptionCode = 'PIC' ) ORDER BY OrderKey, GraphicFileName ASC"),a=0,n=[],r=0,o=Ti.UI.createView({width:265,height:214,left:506,top:70,layout:"horizontal"});i.isValidRow();){{var l,s,d,u,c=i.fieldByName("OptionCode"),f=i.fieldByName("GraphicFileName");i.fieldByName("URL")}if(l=130,s=102,"MIL"==c||"PIC"==c){if("PIC"==c&&(a++,3>a))continue;0==r?(u=0,d=0):1==r?(u=5,d=0):2==r?(u=0,d=10):3==r&&(u=5,d=10);var p=Ti.UI.createScrollView({width:l,height:s,top:d,left:u,borderRadius:"0",contentWidth:Ti.UI.FILL,contentHeight:Ti.UI.FILL,scrollingEnabled:!1}),g=Titanium.UI.createImageView({image:"http://www.venuefinder.com/adverts/"+f,defaultImage:"/images/icon.png",index:r,width:Ti.UI.FILL,height:Ti.UI.FILL,left:0,top:0});if(p.add(g),o.add(p),n.push(g.image),r++,4==r)break}i.next()}return t.close(),o}function createVenueDetail(e){var t=Ti.UI.createView({width:"230",height:"300",bottom:"20",right:"192"}),i=Titanium.UI.createLabel({width:"172",height:"23",top:"0",left:"32",backgroundColor:"transparent",text:"Venue Details",font:{fontSize:"24",fontFamily:Ti.App.Properties.getString("fontFamily")}});t.add(i);var a="<div>"+e.AddressLine1+"</div><div>"+e.Town+", "+e.Country+",</div><div>"+e.Postcode+"</div><div>Tel: "+e.Tel+"</div>",n=Ti.UI.createWebView({html:'<div style="text-align:left;font-family:'+Ti.App.Properties.getString("fontFamily")+'; color:#000; line-height:18pts; font-size:14px;">'+a+"</div>",top:"33",left:"26",width:"200",height:"100",disableBounce:!0});t.add(n);var r="Visit website",o=Titanium.UI.iOS.createAttributedString({text:r});o.addAttribute({type:Titanium.UI.iOS.ATTRIBUTE_UNDERLINES_STYLE,value:Titanium.UI.iOS.ATTRIBUTE_UNDERLINE_STYLE_SINGLE,range:[0,r.length]});var l=Titanium.UI.createLabel({color:"#2195be",font:{fontSize:"14",fontFamily:Ti.App.Properties.getString("fontFamily")},left:"32",top:"143",height:"18",attributedString:o});t.add(l),l.addEventListener("click",function(){var t=Titanium.UI.createWindow({backgroundColor:"rgba(0,0,0,0.8)"}),i=Titanium.UI.createButton({right:"5%",top:"5%",height:"20",zIndex:1,title:"X",color:"#FFF",font:{fontSize:"28",fontWeight:"bold"}});t.add(i),i.addEventListener("click",function(){t.close()});var a=Ti.UI.createView({width:"80%",height:"80%",top:"10%",left:"10%"}),n=Titanium.UI.createWebView({url:e.URL});a.add(n),t.add(a),t.open()});var s="Email this venue",d=Titanium.UI.iOS.createAttributedString({text:s});d.addAttribute({type:Titanium.UI.iOS.ATTRIBUTE_UNDERLINES_STYLE,value:Titanium.UI.iOS.ATTRIBUTE_UNDERLINE_STYLE_SINGLE,range:[0,s.length]});var u=Titanium.UI.createLabel({text:s,color:"#2195be",font:{fontSize:"14",fontFamily:Ti.App.Properties.getString("fontFamily")},left:"32",top:"171",height:"18",attributedString:d});t.add(u),u.addEventListener("click",function(){var t=require("/builders/createEmailer"),i=t(null,e.Email,null,null,e.VenueName,null,null,null,null),a=Titanium.UI.createWindow({backgroundColor:"rgba(0,0,0,0.8)"}),n=Titanium.UI.createButton({right:"5%",top:"5%",height:"20",zIndex:1,title:"X",color:"#FFF",font:{fontSize:"28",fontWeight:"bold"}});a.add(n),n.addEventListener("click",function(){a.close()});var r=Ti.UI.createView({width:"80%",height:"80%",top:"10%",left:"10%"});r.add(i),a.add(r),a.open()});var c="<div style='width:195px'>Max catering capacity<span style='float:right;font-weight:bold'>"+e.MaxCateringCapacity+"</span></div>";c+="<div style='width:195px'>Max meeting capacity<span style='float:right;font-weight:bold'>"+e.MaxMeetingCapacity+"</span></div>",c+="<div style='width:195px'>Number of meeting rooms<span style='float:right;font-weight:bold'>"+e.MeetingRoomsNo+"</span></div>",c+="<div style='width:195px'>Number of bedrooms<span style='float:right;font-weight:bold'>"+e.BedroomsNo+"</span></div>";var f=Ti.UI.createWebView({html:'<div style="left:0px;text-align:left;font-family:'+Ti.App.Properties.getString("fontFamily")+'; color:#000; font-size:13px; line-height:22pts;">'+c+"</div>",top:"199",left:"15",width:"210",height:"100",disableBounce:!0});return t.add(f),t}function seeMoreInfoButton(){var e=Ti.UI.createView({width:130,height:64,bottom:20,right:12,backgroundColor:"#EEEEEE"}),t=Ti.UI.createLabel({width:"102",height:"54",left:"14",bottom:"5",backgroundColor:"#399ad4",color:"#FFFFFF",font:{fontSize:"12",fontFamily:Ti.App.Properties.getString("fontFamily")}}),i=Ti.UI.createLabel({width:"86",height:"44",left:"8",text:"See more information on venuefinder.com",bottom:"5",backgroundColor:"tranparent",color:"#FFFFFF",font:{fontSize:"11"}});return i.addEventListener("click",function(){t.fireEvent("click")}),t.add(i),e.add(t),t.addEventListener("click",function(){var e=Titanium.UI.createWindow({backgroundColor:"rgba(0,0,0,0.8)"}),t=Titanium.UI.createButton({right:"5%",top:"5%",height:"20",zIndex:1,title:"X",color:"#FFF",font:{fontSize:"28",fontWeight:"bold"}});e.add(t),t.addEventListener("click",function(){e.close()});var i=Ti.UI.createView({width:"80%",height:"80%",top:"10%",left:"10%"}),a=Titanium.UI.createWebView({url:"http://www.venuefinder.com"});i.add(a),e.add(i),e.open()}),e}function createSilverSpeOfferBtn(e){var t=createDatabase("/venuefinder.db","venuefinder"),i=require("/builders/todaysDate"),a=i(),n=!1,r=t.execute('SELECT * FROM Offers WHERE EntryID="'+e.VenueID+'" AND validToDate>="'+a+'"');0!=r.rowCount&&(n=!0);var o=null;if(n){o=Ti.UI.createView({right:12,bottom:94,width:130,height:50,backgroundColor:"#EEEEEE"});var l=Titanium.UI.createImageView({image:"/images/listing_offers.png",left:12,top:10,width:102,height:"auto"});o.add(l),l.addEventListener("click",function(){var t=Titanium.UI.createScrollView({top:"0%",zIndex:5,layout:"vertical",backgroundColor:"#FFF"}),i=require("/views/children/listingElements/createOffersTab");i(null,null,t,e.VenueID,null);var a=Titanium.UI.createWindow({backgroundColor:"rgba(0,0,0,0.8)"}),n=Ti.UI.createView({width:"60%",height:"60%",top:"10%",left:"20%",layout:"vertical"}),r=Ti.UI.createView({top:0,left:0,height:"15%",width:"100%",backgroundColor:"#e6a723",layout:"horizontal"}),o=Titanium.UI.createLabel({text:"Special Offers",left:"5%",width:"85%",height:"40",top:"20",ellipsize:!0,color:"#ffffff",font:{fontSize:"34",fontFamily:Ti.App.Properties.getString("fontFamily")}});r.add(o);var l=Titanium.UI.createButton({right:"0",top:"0",height:"80",width:"60",title:"X",color:"#FFF",font:{fontSize:"28",fontWeight:"bold"}});r.add(l),l.addEventListener("click",function(){a.close()}),n.add(r),n.add(t),a.add(n),a.open()})}return t.close(),o}function singleImage(){var e=Ti.UI.createView({width:"130",height:"102",bottom:"154",right:"12",backgroundColor:"#dededc"});return e}var createImageGallery=require("views/collview/ImageGallery/createImageGallery"),createHeaderElements=require("/views/collview/listingElements/createHeaderElementsios"),createDatabase=require("/builders/databaseFunctions/createDatabase"),dbUtil=require("/builders/databaseFunctions/dbUtil");module.exports.createDetailPage=createDetailPage;